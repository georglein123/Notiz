增加光机关机功能

client: controllernode

server: projectornode

service通道



client

创建client

![image-20230504140204239](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504140204239.png)



```c++
initProj_cli = this->create_client<protocol::srv::ProjInit>(EToS(topics::Topic::ProjInit));
	//创建projClose_cli client，使用service通道为protocol::srv::ProjClose
    projClose_cli = this->create_client<protocol::srv::ProjClose>(EToS(topics::Topic::ProjClose));
    switchLED_cli = this->create_client<protocol::srv::ProjSwitchLED>(EToS(topics::Topic::ProjSwitchLED));
```



```c++
bool ControlNode::closeProjector()
{
	//创建request
    //？ request的结构在该路径下protocol::srv::ProjClose::Request
    auto req = std::make_shared<protocol::srv::ProjClose::Request>();

    auto reply = ros::Request(projClose_cli, req, 5000, 30000);
    if(reply.error)
    {
        return reply.error;
    }
	//返回结果
    return reply.result->ret;
}
```



头文件

![image-20230504140248154](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504140248154.png)





创建一个service文件，client和server交流的通道，service的内容格式（点划线上方为request，下方为response）

![image-20230504142740215](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504142740215.png)



创建server

![image-20230504140509517](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504140509517.png)





```c++
void ProjectorNode::closeProj(const protocol::srv::ProjClose_Request::SharedPtr req, const protocol::srv::ProjClose_Response::SharedPtr res)
{
    Q_UNUSED(req);

    res->ret = mProjector->Close();
    return ;
}

```









![image-20230504140551425](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504140551425.png)



添加一个空行，让其重新编译，否则cmakelist可以不会编译

![image-20230504142057622](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504142057622.png)





![image-20230504142802118](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230504142802118.png)
