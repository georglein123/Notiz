

问题：使用M值工艺包打印的满版实心全颌面牙模的底板层的表面质量和非底板层存在突变，并且底板层的表面质量更好，探究是什么原因导致底板层表面质量更优？

![image-20220407144023402](E:\文档\GitHub\Notiz\底板层表面质量较好原因排查及验证.assets\image-20220407144023402.png)



**底板层层数20（ultm切片文件的配置文件参数和ult格式不太相同）**

![image-20220407142856073](E:\文档\GitHub\Notiz\底板层表面质量较好原因排查及验证.assets\image-20220407142856073.png)



**0-20层计算M值**

![image-20220407133020591](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220407133020591.png)

**M值工艺包对应段工艺参数**

```c++
{
                "MLowerLimit": 190,
                "MUpperLimit": 538,
                "Number": 15,
                "WaitTime": 16000,
                "Z_AxisUp": [
                    { "v": 600, "s": 1000 },
                    { "v": 200, "s": 2400 },
                    { "v": 3000, "s": 3200 },
                    { "v": 10000, "s": 18900 },
                    { "v": 10000, "s": 18900 }
                ],
                "Z_AxisDown": [
                    { "v": 10000, "s": -15850 },
                    { "v": 3000, "s": -17850 },
                    { "v": 300, "s": -18050 },
                    { "v": 200, "s": -18650 },
                    { "v": 100, "s": -18850 }
                ]
            }
```

4K打印机打印日志：经确认确实调用了该段工艺参数

M值工艺包底板层在M值小于90时，会使用其他工艺策略，这个策略已和肖工确认过，写入了上位机系统里

```c++
[2022-04-06 09:42:29.343] [DEBUG] [ "实心牙模2-4K.ult" ] layer start: 20 / 583
[2022-04-06 09:42:29.344] [TRACE] [ProjectCtrl] OnExposure
[2022-04-06 09:42:29.344] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Exposuring)
[2022-04-06 09:42:29.345] [TRACE] previewImg show time is  1
[2022-04-06 09:42:29.345] [WARN] SendMqttMsg 566 disconnect ultranet, donot publish intermediate state!
[2022-04-06 09:42:29.345] [DEBUG] Start Image Process,Layer:  30 step: 10
[2022-04-06 09:42:29.350] [DEBUG] handle base and get ELayerImgType_Object
[2022-04-06 09:42:29.350] [TRACE] ULT: other Layer
[2022-04-06 09:42:29.350] [DEBUG] src_mat fixed ... 1
[2022-04-06 09:42:29.350] [DEBUG] src_mat fixed ... 0 "/tmp/.A2DTemp/S000030_P1.png"
[2022-04-06 09:42:29.381] [TRACE] [ProjectCtrl] the current is: 302
[2022-04-06 09:42:29.381] [TRACE] [Projector] LedOn
[2022-04-06 09:42:29.381] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:42:29.381] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:42:29.381] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:42:29.381] [TRACE] SetLedOnOff
[2022-04-06 09:42:29.382] [TRACE] [ProjectorInterface] open_led success
[2022-04-06 09:42:29.382] [DEBUG] [Projector] LedOn result: no support
[2022-04-06 09:42:29.382] [TRACE] [ProjectCtrl] OnExposure preset time: 1506
[2022-04-06 09:42:29.388] [DEBUG] bObjImg  true
[2022-04-06 09:42:29.388] [DEBUG] wearhole scale  false
[2022-04-06 09:42:29.398] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:42:29.549] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:42:29.549] [DEBUG] ShapeAdjust completed ... src_mat rows,cols 2160 3840
[2022-04-06 09:42:29.679] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:42:29.796] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:42:29.808] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:42:29.927] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:42:29.928] [DEBUG] GetDemixMat Demix after and before image: "/tmp/.A2DTemp/S000040_P1.png" "/tmp/.A2DTemp/S000020_P1.png" 30
[2022-04-06 09:42:30.100] [DEBUG] NotBaseLayer and DoDemix.
[2022-04-06 09:42:30.590] [DEBUG] num of context.exposure is : 3
[2022-04-06 09:42:30.590] [DEBUG] 第 30 张图片的曝光的时间为:
[2022-04-06 09:42:30.590] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 30 layer of theory: 30 Type: 1 Energy: 21 ExposeTime: 0
[2022-04-06 09:42:30.590] [DEBUG] 第 30 张图片的曝光的时间为:
[2022-04-06 09:42:30.590] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 30 layer of theory: 30 Type: 2 Energy: 21 ExposeTime: 1500
[2022-04-06 09:42:30.591] [DEBUG] 第 30 张图片的曝光的时间为:
[2022-04-06 09:42:30.591] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 30 layer of theory: 30 Type: 4 Energy: 0 ExposeTime: 0
[2022-04-06 09:42:30.592] [DEBUG] 第  30 张图片的上升距离为:isAdaptive= false 的工艺包数据：= 18900 true QVector(1000, 2400, 3200, 18900, 18900) 216.185
[2022-04-06 09:42:30.592] [DEBUG] 第  30 层下降距离为:isAdaptive= false 的工艺包数据：= -18850
[2022-04-06 09:42:30.592] [DEBUG] layers  30 's energy is:  21
[2022-04-06 09:42:30.593] [DEBUG] layers  30 's current is:  302
[2022-04-06 09:42:30.593] [DEBUG] layers  30 's energy is:  21
[2022-04-06 09:42:30.593] [DEBUG] layers  30 's current is:  302
[2022-04-06 09:42:30.594] [DEBUG] layers  30 's energy is:  0
[2022-04-06 09:42:30.594] [DEBUG] layers  30 's current is:  80
[2022-04-06 09:42:30.594] [DEBUG] context enqueue  i : 29 context object layer : 30 context show layer is  30 

[2022-04-06 09:42:30.888] [TRACE] [ProjectCtrl] [exposure][time]: 1542
[2022-04-06 09:42:30.889] [TRACE] [Projector] LedOff
[2022-04-06 09:42:30.890] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:42:30.891] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:42:30.892] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:42:30.892] [TRACE] SetLedOnOff
[2022-04-06 09:42:30.893] [TRACE] [ProjectorInterface] close_led success
[2022-04-06 09:42:30.894] [DEBUG] [Projector] LedOff result: no support
[2022-04-06 09:42:30.947] [TRACE] OnEnviromentCheck 57 data: QMap(("Projector", QVariant(bool, true))("Screen", QVariant(bool, true)))
[2022-04-06 09:42:30.947] [TRACE] - 20 - [exposure][time] 1603 [exposure][offset time] 97
[2022-04-06 09:42:30.948] [DEBUG] begin SyncPeel
[2022-04-06 09:42:30.948] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Peeling)
[2022-04-06 09:42:30.948] [TRACE] command: "ac100118ff00000400000001d227acdc"
[2022-04-06 09:42:30.984] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000001d227acdc"
[2022-04-06 09:42:31.019] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-97.80"
[2022-04-06 09:42:31.919] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "19.20"
[2022-04-06 09:42:41.938] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:42:41.938] [DEBUG] end SyncPeel
[2022-04-06 09:42:41.940] [TRACE] Escape 0 1376520
[2022-04-06 09:42:41.940] [DEBUG] begin SyncPeel
[2022-04-06 09:42:41.940] [TRACE] command: "ac100118ff00000400000002d367acdc"
[2022-04-06 09:42:41.951] [DEBUG] discard slave return result 
[2022-04-06 09:42:41.969] [DEBUG] discard slave return result 
[2022-04-06 09:42:41.987] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000002d367acdc"
[2022-04-06 09:42:43.520] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-26.10"
[2022-04-06 09:42:49.952] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:42:49.953] [DEBUG] end SyncPeel
[2022-04-06 09:42:49.954] [TRACE] Escape 0 1376520
    
 第20层调用工艺包最后一段
    
[2022-04-06 09:42:49.955] [TRACE] [PrintCtrl] peel up:
[2022-04-06 09:42:49.956] [TRACE] [PrintCtrl] speed[0]: 600, distance[0]: 1000
[2022-04-06 09:42:49.956] [TRACE] [PrintCtrl] speed[1]: 200, distance[1]: 2400
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] speed[2]: 3000, distance[2]: 3200
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] speed[3]: 10000, distance[3]: 18900
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] speed[4]: 10000, distance[4]: 18900
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] peel down:
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] speed[0]: 10000, distance[0]: -15850
[2022-04-06 09:42:49.957] [TRACE] [PrintCtrl] speed[1]: 3000, distance[1]: -17850
[2022-04-06 09:42:49.958] [TRACE] [PrintCtrl] speed[2]: 300, distance[2]: -18050
[2022-04-06 09:42:49.958] [TRACE] [PrintCtrl] speed[3]: 200, distance[3]: -18650
[2022-04-06 09:42:49.959] [TRACE] [PrintCtrl] speed[4]: 100, distance[4]: -18850
[2022-04-06 09:42:49.960] [TRACE] - 20 - [peel][time] 19008 [peel][offset time] 589
[2022-04-06 09:42:49.960] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Waiting)
[2022-04-06 09:42:50.019] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-0 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-111.10"
[2022-04-06 09:43:05.955] [TRACE] - 20 - [wait][time] 16000 [wait][offset time] 0
[2022-04-06 09:43:05.956] [DEBUG] [ "实心牙模2-4K.ult" ] layer done
[2022-04-06 09:43:05.956] [TRACE]  ====== Begin Read Model  21 `th Loop ====== 
[2022-04-06 09:43:05.956] [DEBUG] ReadModel 291
[2022-04-06 09:43:05.956] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Preprocessing)
[2022-04-06 09:43:05.957] [DEBUG] the buffer is not Empty
[2022-04-06 09:43:05.957] [DEBUG] Read Model Parser Finished!
[2022-04-06 09:43:05.957] [DEBUG] 

[2022-04-06 09:43:05.957] [DEBUG] - 21 - [exposure][begin]
[2022-04-06 09:43:05.957] [DEBUG] =================================== loop  30
[2022-04-06 09:43:05.957] [DEBUG] --------
[2022-04-06 09:43:05.958] [DEBUG] 进入这里-正常取图 31
[2022-04-06 09:43:05.958] [DEBUG] [ "实心牙模2-4K.ult" ] layer start: 21 / 583
[2022-04-06 09:43:05.958] [TRACE] [ProjectCtrl] OnExposure
[2022-04-06 09:43:05.959] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Exposuring)
[2022-04-06 09:43:05.959] [TRACE] previewImg show time is  1
[2022-04-06 09:43:05.959] [DEBUG] Start Image Process,Layer:  31 step: 10
[2022-04-06 09:43:05.961] [DEBUG] handle base and get ELayerImgType_Object
[2022-04-06 09:43:05.961] [TRACE] ULT: other Layer
[2022-04-06 09:43:05.962] [DEBUG] src_mat fixed ... 1
[2022-04-06 09:43:05.962] [DEBUG] src_mat fixed ... 0 "/tmp/.A2DTemp/S000031_P1.png"
[2022-04-06 09:43:05.959] [WARN] SendMqttMsg 566 disconnect ultranet, donot publish intermediate state!
[2022-04-06 09:43:05.983] [TRACE] [ProjectCtrl] the current is: 302
[2022-04-06 09:43:05.983] [TRACE] [Projector] LedOn
[2022-04-06 09:43:05.983] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:43:05.983] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:43:05.983] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:43:05.985] [TRACE] SetLedOnOff
[2022-04-06 09:43:05.985] [TRACE] [ProjectorInterface] open_led success
[2022-04-06 09:43:05.986] [DEBUG] [Projector] LedOn result: no support
[2022-04-06 09:43:05.986] [TRACE] [ProjectCtrl] OnExposure preset time: 1500
[2022-04-06 09:43:06.002] [DEBUG] bObjImg  true
[2022-04-06 09:43:06.002] [DEBUG] wearhole scale  false
[2022-04-06 09:43:06.012] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:06.166] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:06.166] [DEBUG] ShapeAdjust completed ... src_mat rows,cols 2160 3840
[2022-04-06 09:43:06.275] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:06.402] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:06.410] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:06.538] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:06.538] [DEBUG] GetDemixMat Demix after and before image: "/tmp/.A2DTemp/S000041_P1.png" "/tmp/.A2DTemp/S000021_P1.png" 31
[2022-04-06 09:43:06.730] [DEBUG] NotBaseLayer and DoDemix.
[2022-04-06 09:43:07.224] [DEBUG] num of context.exposure is : 3
[2022-04-06 09:43:07.225] [DEBUG] 第 31 张图片的曝光的时间为:
[2022-04-06 09:43:07.225] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 31 layer of theory: 31 Type: 1 Energy: 21 ExposeTime: 0
[2022-04-06 09:43:07.225] [DEBUG] 第 31 张图片的曝光的时间为:
[2022-04-06 09:43:07.226] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 31 layer of theory: 31 Type: 2 Energy: 21 ExposeTime: 1500
[2022-04-06 09:43:07.226] [DEBUG] 第 31 张图片的曝光的时间为:
[2022-04-06 09:43:07.226] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 31 layer of theory: 31 Type: 4 Energy: 0 ExposeTime: 0
[2022-04-06 09:43:07.227] [DEBUG] 第  31 张图片的上升距离为:isAdaptive= false 的工艺包数据：= 18900 true QVector(1000, 2400, 3200, 18900, 18900) 216.169
[2022-04-06 09:43:07.227] [DEBUG] 第  31 层下降距离为:isAdaptive= false 的工艺包数据：= -18850
[2022-04-06 09:43:07.227] [DEBUG] layers  31 's energy is:  21
[2022-04-06 09:43:07.228] [DEBUG] layers  31 's current is:  302
[2022-04-06 09:43:07.228] [DEBUG] layers  31 's energy is:  21
[2022-04-06 09:43:07.228] [DEBUG] layers  31 's current is:  302
[2022-04-06 09:43:07.228] [DEBUG] layers  31 's energy is:  0
[2022-04-06 09:43:07.229] [DEBUG] layers  31 's current is:  80
[2022-04-06 09:43:07.229] [DEBUG] context enqueue  i : 30 context object layer : 31 context show layer is  31 

[2022-04-06 09:43:07.487] [TRACE] [ProjectCtrl] [exposure][time]: 1527
[2022-04-06 09:43:07.487] [TRACE] [Projector] LedOff
[2022-04-06 09:43:07.487] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:43:07.487] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:43:07.487] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:43:07.488] [TRACE] SetLedOnOff
[2022-04-06 09:43:07.488] [TRACE] [ProjectorInterface] close_led success
[2022-04-06 09:43:07.490] [DEBUG] [Projector] LedOff result: no support
[2022-04-06 09:43:07.540] [TRACE] OnEnviromentCheck 57 data: QMap(("Projector", QVariant(bool, true))("Screen", QVariant(bool, true)))
[2022-04-06 09:43:07.540] [DEBUG] begin SyncPeel
[2022-04-06 09:43:07.540] [TRACE] - 21 - [exposure][time] 1582 [exposure][offset time] 82
[2022-04-06 09:43:07.541] [TRACE] command: "ac100118ff00000400000001d227acdc"
[2022-04-06 09:43:07.541] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Peeling)
[2022-04-06 09:43:07.578] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000001d227acdc"
[2022-04-06 09:43:07.619] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-97.40"
[2022-04-06 09:43:08.519] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "3.10"
[2022-04-06 09:43:18.574] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:43:18.574] [DEBUG] end SyncPeel
[2022-04-06 09:43:18.575] [TRACE] Escape 0 1376520
[2022-04-06 09:43:18.576] [DEBUG] begin SyncPeel
[2022-04-06 09:43:18.578] [TRACE] command: "ac100118ff00000400000002d367acdc"
[2022-04-06 09:43:18.587] [DEBUG] discard slave return result 
[2022-04-06 09:43:18.606] [DEBUG] discard slave return result 
[2022-04-06 09:43:18.633] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-0 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "1.70"
[2022-04-06 09:43:18.651] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000002d367acdc"
[2022-04-06 09:43:18.718] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "1.40"
[2022-04-06 09:43:20.118] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-18.00"
[2022-04-06 09:43:24.618] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-107.10"
[2022-04-06 09:43:24.718] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-107.10"
[2022-04-06 09:43:26.592] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:43:26.592] [DEBUG] end SyncPeel
[2022-04-06 09:43:26.593] [TRACE] Escape 0 1376520
[2022-04-06 09:43:26.594] [TRACE] [PrintCtrl] peel up:

第21层调用工艺包最后一段
    
[2022-04-06 09:43:26.595] [TRACE] [PrintCtrl] speed[0]: 600, distance[0]: 1000
[2022-04-06 09:43:26.595] [TRACE] [PrintCtrl] speed[1]: 200, distance[1]: 2400
[2022-04-06 09:43:26.595] [TRACE] [PrintCtrl] speed[2]: 3000, distance[2]: 3200
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] speed[3]: 10000, distance[3]: 18900
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] speed[4]: 10000, distance[4]: 18900
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] peel down:
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] speed[0]: 10000, distance[0]: -15850
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] speed[1]: 3000, distance[1]: -17850
[2022-04-06 09:43:26.599] [TRACE] [PrintCtrl] speed[2]: 300, distance[2]: -18050
[2022-04-06 09:43:26.600] [TRACE] [PrintCtrl] speed[3]: 200, distance[3]: -18650
[2022-04-06 09:43:26.600] [TRACE] [PrintCtrl] speed[4]: 100, distance[4]: -18850
[2022-04-06 09:43:26.600] [TRACE] - 21 - [peel][time] 19054 [peel][offset time] 635
[2022-04-06 09:43:26.600] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Waiting)
[2022-04-06 09:43:26.655] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-0 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-111.10"
[2022-04-06 09:43:42.594] [TRACE] - 21 - [wait][time] 16000 [wait][offset time] 0
[2022-04-06 09:43:42.594] [TRACE]  ====== Begin Read Model  22 `th Loop ====== 
[2022-04-06 09:43:42.594] [DEBUG] [ "实心牙模2-4K.ult" ] layer done
[2022-04-06 09:43:42.594] [DEBUG] ReadModel 291
[2022-04-06 09:43:42.594] [DEBUG] the buffer is not Empty
[2022-04-06 09:43:42.594] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Preprocessing)
[2022-04-06 09:43:42.595] [DEBUG] Read Model Parser Finished!
[2022-04-06 09:43:42.595] [DEBUG] 

[2022-04-06 09:43:42.595] [DEBUG] --------
[2022-04-06 09:43:42.595] [DEBUG] =================================== loop  31
[2022-04-06 09:43:42.595] [DEBUG] [ "实心牙模2-4K.ult" ] layer start: 22 / 583
[2022-04-06 09:43:42.595] [DEBUG] - 22 - [exposure][begin]
[2022-04-06 09:43:42.595] [DEBUG] 进入这里-正常取图 32
[2022-04-06 09:43:42.596] [TRACE] [ProjectCtrl] OnExposure
[2022-04-06 09:43:42.596] [WARN] SendMqttMsg 566 disconnect ultranet, donot publish intermediate state!
[2022-04-06 09:43:42.596] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Exposuring)
[2022-04-06 09:43:42.596] [TRACE] previewImg show time is  0
[2022-04-06 09:43:42.596] [DEBUG] Start Image Process,Layer:  32 step: 10
[2022-04-06 09:43:42.599] [DEBUG] handle base and get ELayerImgType_Object
[2022-04-06 09:43:42.600] [TRACE] ULT: other Layer
[2022-04-06 09:43:42.600] [DEBUG] src_mat fixed ... 1
[2022-04-06 09:43:42.600] [DEBUG] src_mat fixed ... 0 "/tmp/.A2DTemp/S000032_P1.png"
[2022-04-06 09:43:42.621] [TRACE] [ProjectCtrl] the current is: 302
[2022-04-06 09:43:42.621] [TRACE] [Projector] LedOn
[2022-04-06 09:43:42.621] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:43:42.621] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:43:42.621] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:43:42.621] [TRACE] SetLedOnOff
[2022-04-06 09:43:42.622] [TRACE] [ProjectorInterface] open_led success
[2022-04-06 09:43:42.622] [DEBUG] [Projector] LedOn result: no support
[2022-04-06 09:43:42.622] [TRACE] [ProjectCtrl] OnExposure preset time: 1500
[2022-04-06 09:43:42.629] [DEBUG] bObjImg  true
[2022-04-06 09:43:42.629] [DEBUG] wearhole scale  false
[2022-04-06 09:43:42.637] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:42.781] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:42.781] [DEBUG] ShapeAdjust completed ... src_mat rows,cols 2160 3840
[2022-04-06 09:43:42.886] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:43.014] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:43.019] [DEBUG] IsRemap 60 校准是否打开 true
[2022-04-06 09:43:43.149] [DEBUG] ZoomIn Success to transform the image: 3861 2172 1.0055 1.0055
[2022-04-06 09:43:43.150] [DEBUG] GetDemixMat Demix after and before image: "/tmp/.A2DTemp/S000042_P1.png" "/tmp/.A2DTemp/S000022_P1.png" 32
[2022-04-06 09:43:43.325] [DEBUG] NotBaseLayer and DoDemix.
[2022-04-06 09:43:43.830] [DEBUG] num of context.exposure is : 3
[2022-04-06 09:43:43.831] [DEBUG] 第 32 张图片的曝光的时间为:
[2022-04-06 09:43:43.831] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 32 layer of theory: 32 Type: 1 Energy: 21 ExposeTime: 0
[2022-04-06 09:43:43.831] [DEBUG] 第 32 张图片的曝光的时间为:
[2022-04-06 09:43:43.831] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 32 layer of theory: 32 Type: 2 Energy: 21 ExposeTime: 1500
[2022-04-06 09:43:43.831] [DEBUG] 第 32 张图片的曝光的时间为:
[2022-04-06 09:43:43.831] [DEBUG] UpdateExposeParam 0:obj,1:contour,2:fill,3:support,4:preview layer of context: 32 layer of theory: 32 Type: 4 Energy: 0 ExposeTime: 0
[2022-04-06 09:43:43.831] [DEBUG] 第  32 张图片的上升距离为:isAdaptive= false 的工艺包数据：= 18900 true QVector(1000, 2400, 3200, 18900, 18900) 216.123
[2022-04-06 09:43:43.831] [DEBUG] 第  32 层下降距离为:isAdaptive= false 的工艺包数据：= -18850
[2022-04-06 09:43:43.832] [DEBUG] layers  32 's energy is:  21
[2022-04-06 09:43:43.832] [DEBUG] layers  32 's current is:  302
[2022-04-06 09:43:43.832] [DEBUG] layers  32 's energy is:  21
[2022-04-06 09:43:43.832] [DEBUG] layers  32 's current is:  302
[2022-04-06 09:43:43.832] [DEBUG] layers  32 's energy is:  0
[2022-04-06 09:43:43.833] [DEBUG] layers  32 's current is:  80
[2022-04-06 09:43:43.833] [DEBUG] context enqueue  i : 31 context object layer : 32 context show layer is  32 

[2022-04-06 09:43:44.122] [TRACE] [ProjectCtrl] [exposure][time]: 1523
[2022-04-06 09:43:44.124] [TRACE] [Projector] LedOff
[2022-04-06 09:43:44.125] [TRACE] [Ddp442x] setLedOnOff
[2022-04-06 09:43:44.125] [TRACE] [Ddp442xApi] GpioOpen
[2022-04-06 09:43:44.126] [TRACE] [Ddp442xApi] OpenWithRetry interfacenum: 2 , pre2retry: 3
[2022-04-06 09:43:44.131] [TRACE] SetLedOnOff
[2022-04-06 09:43:44.133] [TRACE] [ProjectorInterface] close_led success
[2022-04-06 09:43:44.133] [DEBUG] [Projector] LedOff result: no support
[2022-04-06 09:43:44.181] [TRACE] OnEnviromentCheck 57 data: QMap(("Projector", QVariant(bool, true))("Screen", QVariant(bool, true)))
[2022-04-06 09:43:44.182] [TRACE] - 22 - [exposure][time] 1585 [exposure][offset time] 85
[2022-04-06 09:43:44.182] [DEBUG] begin SyncPeel
[2022-04-06 09:43:44.183] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Peeling)
[2022-04-06 09:43:44.183] [TRACE] command: "ac100118ff00000400000001d227acdc"
[2022-04-06 09:43:44.236] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000001d227acdc"
[2022-04-06 09:43:44.318] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-97.50"
[2022-04-06 09:43:45.118] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-2.10"
[2022-04-06 09:43:55.061] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:43:55.062] [DEBUG] end SyncPeel
[2022-04-06 09:43:55.062] [TRACE] Escape 0 1376520
[2022-04-06 09:43:55.062] [DEBUG] begin SyncPeel
[2022-04-06 09:43:55.063] [TRACE] command: "ac100118ff00000400000002d367acdc"
[2022-04-06 09:43:55.081] [DEBUG] discard slave return result 
[2022-04-06 09:43:55.100] [DEBUG] discard slave return result 
[2022-04-06 09:43:55.118] [DEBUG] NotifyComm 通訊返回 "ac100118ff00000400000002d367acdc"
[2022-04-06 09:43:55.137] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "1.40"
[2022-04-06 09:43:55.218] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-0 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "1.10"
[2022-04-06 09:43:56.618] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-0 ZR-0 ZZ-1 ZP-1 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-23.20"
[2022-04-06 09:44:03.071] [TRACE] exe result: "ZAXIS->SEGMENTED_MOTION" "COMMAND_SUCCESS"
[2022-04-06 09:44:03.071] [DEBUG] end SyncPeel
[2022-04-06 09:44:03.072] [TRACE] Escape 0 1376520
[2022-04-06 09:44:03.074] [TRACE] [PrintCtrl] peel up:
[2022-04-06 09:44:03.074] [TRACE] [PrintCtrl] speed[0]: 600, distance[0]: 1000
[2022-04-06 09:44:03.074] [TRACE] [PrintCtrl] speed[1]: 200, distance[1]: 2400
[2022-04-06 09:44:03.075] [TRACE] [PrintCtrl] speed[2]: 3000, distance[2]: 3200
[2022-04-06 09:44:03.076] [TRACE] [PrintCtrl] speed[3]: 10000, distance[3]: 18900
[2022-04-06 09:44:03.077] [TRACE] [PrintCtrl] speed[4]: 10000, distance[4]: 18900
[2022-04-06 09:44:03.077] [TRACE] [PrintCtrl] peel down:
[2022-04-06 09:44:03.078] [TRACE] [PrintCtrl] speed[0]: 10000, distance[0]: -15850
[2022-04-06 09:44:03.079] [TRACE] [PrintCtrl] speed[1]: 3000, distance[1]: -17850
[2022-04-06 09:44:03.080] [TRACE] [PrintCtrl] speed[2]: 300, distance[2]: -18050
[2022-04-06 09:44:03.081] [TRACE] [PrintCtrl] speed[3]: 200, distance[3]: -18650
[2022-04-06 09:44:03.081] [TRACE] [PrintCtrl] speed[4]: 100, distance[4]: -18850
[2022-04-06 09:44:03.082] [TRACE] - 22 - [peel][time] 18891 [peel][offset time] 472
[2022-04-06 09:44:03.082] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Waiting)
[2022-04-06 09:44:03.134] [TRACE] Slave State change:  "ES-0 OPR-0 OPL-0 NP-1 ZT-0 ZB-0 ZS-1 ZR-0 ZZ-1 ZP-0 CAU-1 CAL-0 CGU-1 CGD-0 TL-1 CAE-0 ZAE-0 SP-1 ST-1 HES-1"  | F- "-110.80"
[2022-04-06 09:44:19.074] [TRACE] - 22 - [wait][time] 16001 [wait][offset time] 1
[2022-04-06 09:44:19.075] [DEBUG] [ "实心牙模2-4K.ult" ] layer done
[2022-04-06 09:44:19.075] [TRACE]  ====== Begin Read Model  23 `th Loop ====== 
[2022-04-06 09:44:19.075] [DEBUG] [ "实心牙模2-4K.ult" ] step: PrintCtrl::PrintStep(Preprocessing)
[2022-04-06 09:44:19.075] [DEBUG] ReadModel 291
[2022-04-06 09:44:19.076] [DEBUG] the buffer is not Empty
[2022-04-06 09:44:19.076] [DEBUG] Read Model Parser Finished!
[2022-04-06 09:44:19.076] [DEBUG] 
```

**可能原因1：曝光时间比非底板层长**

![image-20220407140008246](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220407140008246.png)

**验证方法：**

- 工艺包中底板层曝光起始时间变成1500，观察打印件的底板层表面质量是否变差

```c++
"Strategy": {
        "Name": "HD(50um)",
        "Thickness": 50,
		"Offset": 0,
        "LedExposeTime": 1500,
        "LedPower": 21.00,
        "SupportExposeTime": 750,
        "SupportExposePower": 21.00,
        "FirstExposeTime": 3500,
        "FirstExposePower": 21.00,
        "BaseThickness": 1000,
        "BaseStartExposeTime": 3000,  将时间改为1500
        "BaseEndExposeTime": 1500,
        "ProfileExposeTime": 100,
        "FillExposePower":21.00,
        "FillExposeTime": 1500,
        "PeelMode": 1,
```

改包经过打印测试后，底板层的打印质量依然好于非底板层，依然存在突变

![image-20220408165908552](E:\文档\GitHub\Notiz\底板层表面质量较好原因排查及验证.assets\image-20220408165908552.png)

同时打印日志也确定底板层的曝光时间确实减少

![image-20220408170230203](E:\文档\GitHub\Notiz\底板层表面质量较好原因排查及验证.assets\image-20220408170230203.png)

证明曝光时间并不是改善底板层表面质量的原因

- 将非底板层的曝光时间延长，观察打印件表面质量是否改善

  这一测试方法可以排除，曝光时间长并不是改善底板层表面质量的原因

**可能原因2：底板层无轮廓填充分离策略作用，轮廓填充分离策略使表面质量变差**

验证方法：将底板层的高度设置更高，因为底板层不适用轮廓填充分离策略，不需要打印全部层数，打印后观察打印件的表面质量，和现在对比，表面质量好的部分是否变高

将底板层厚度设置为4mm，表面质量变好的高度也升高

同时，关闭轮廓填充分离策略打印，确实表面质量整体变好

经确认：轮廓填充分离策略会使表面质量变差

