chairside 自动均匀性校准新流程及复检界面使用V1.0

[TOC]

#### 〇、开始前必须核查项

1. **相机模组校准高度是否已设置**

查看方式：`heygears@heygears:~$ sudo vim /usr/local/ultracore/.env`

查看该文件中是否有关键字`CALIB_FALL`参数并进行了配置

![image-20220715120621319](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715120621319.png)

如若未配置，则配置后再进行后续步骤，设置及配置该参数可联系张海东。



2. **后台拟合算法参数文件是否是最新版格式**

进入如下图所示路径`/home/heygears/.clinic`， 打开文件`autograycalib.json`

![image-20220715121705602](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715121705602.png)

如果打开的文件格式不符合下图所示，则用最新版格式的该文件替换，该文件可联系黄俊。



![image-20220715121557626](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715121557626.png)



**以上核查没有问题后才可进入以下步骤：**

开启打印机后

#### 一、安装相机模组

#### 二、放入新的背光膜（一次性，不可重复使用）

1. 按照下图图示，找到背光膜正确的一面，并撕开背光膜（注意：勿触摸背光膜的中间部分）

![image-20220715131656974](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715131656974.png)



2. 并将此面朝上，放入打印机料盘中（膜的左上缺角部分对应料盘左上角），如下图所示

![image-20220715132741355](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715132741355.png)



3. 关闭打印机舱门

#### 三、关闭`相机SN校验`（每次重启后`相机SN校验`都会开启，需要手动关闭）

1. 点击`运维设置`

![image-20220715092159247](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715092159247.png)



2. 连续点击`运维设置`5次后，输入动态密码，点击`完成`

![image-20220712173953522](E:\文档\GitHub\Notiz\chairside 自动均匀性校准.assets\image-20220712173953522.png)



3. 进入如下界面，点击`开发者选项`

![image-20220712174027875](E:\文档\GitHub\Notiz\chairside 自动均匀性校准.assets\image-20220712174027875.png)



4. 保证`相机SN校验`选项未选中，即为关闭`相机SN校验`（该功能为了保证同一台打印机配置同一块模组，避免混用，现处于自动均匀性校准模块测试阶段，不需要该功能）

![image-20220712174130856](E:\文档\GitHub\Notiz\chairside 自动均匀性校准.assets\image-20220712174130856.png)



#### 四、自动均匀性校准

1. 在打印机操作界面，点击`光机校准`

![image-20220712174257225](E:\文档\GitHub\Notiz\chairside 自动均匀性校准.assets\image-20220712174257225.png)



2. 按界面提示点击`下一步`

![image-20220715091653465](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715091653465.png)



（若出现如下问题提示界面，则表示未关闭`相机SN校验`，关闭方法见前文）

![image-20220715091752128](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715091752128.png)



3. 关闭`相机SN校验`后，则出现以下提示界面，`安装光机校准镜头` 正常，点击`下一步`

![image-20220715092707572](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715092707572.png)



4. 继续点击`下一步`

![image-20220715092821562](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715092821562.png)



5. 接着点击`开始校准`，即可进入自动均匀性校准过程

![image-20220715092906841](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715092906841.png)



自动均匀性校准过程开始

![image-20220715092959850](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715092959850.png)



等待自动均匀性校准完成（完成后会生成一张新的mask，覆盖文件夹中存在的mask，在这个过程中，会捕获电流I和灰度G的关系）

（自动均匀性校准完成后会在以下路径中生成自动均匀性校准的的mask）![image-20220712135332543](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220712135332543.png)



#### 五、获取自动Mask的PI

1. 在打印机上插上键盘，在键盘上同时按下`Alt`和`Tab`键，选择`Form`调试界面，出现以下界面，选择`自动校准调试`选项卡，并点击`开始自动Mask的PI`

![image-20220714211238579](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220714211238579.png)



2. 此时出现提示信息，料盘中也会出现圆斑图，将光度计插入打印机，并按照圆斑图的位置对准，放置在料盘上，放置好之后再点击 `OK`

![image-20220715093704737](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715093704737.png)



3. 点击 `OK`后，将开始捕获指定电流下的光强值，`当前能量列表` 栏中不断更新数值，即为`当前电流列表`中电流对应的光强值

![image-20220715094540013](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715094540013.png)

（`自动Mask的PI`的记录数据放置路径）

![image-20220715094215116](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715094215116.png)



5. `自动Mask的PI`过程完成后，弹出如下提示窗口，点击`OK`

![image-20220715094659205](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715094659205.png)



（若出现以下问题 `拟合KB失败`，此时需要做一次自动均匀性校准后，再进行`开始自动Mask的PI`）

![image-20220715095047510](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715095047510.png)



6. 弹出`拟合KB成功`提示框后，获取自动Mask的PI的过程即完成



#### 六、二次自动均匀性校准

获取自动Mask的PI的过程完成后，需要再做一次自动均匀性校准，应用拟合KB结果（自动均匀性校准过程见前文）。



#### 七、复检

以上所有步骤按流程完成后，即可进行复检

1. **复检界面说明：**

`自动Mask`：调用的mask为自动均匀性校准生成的mask

`手动Mask`：请勿选择该选项！（该项表示调用的mask为手动均匀性校准生成的mask，而系统中并没有手动mask的PI，无法对比光强，所以勿选择）

`无Mask`：不调用mask

`设置能量（自动拟合）`：通过自动光强校准算法拟合出来的光强

`设置能量（手动拟合）`：通过自动mask的PI采集到的数据计算出来的光强

2. **复检界面使用测试步骤：**

2.1 选中模式`自动Mask`（默认只允许使用该种模式），点击`选择图片`进行指定投图

2.2 选择图片完成后，接着点击`LED ON`

2.3 然后在`设置能量(自动拟合)`或`设置能量（手动拟合）`右边的输入框中输入理想光强数值

2.4之后点击`设置能量(自动拟合)`或`设置能量（手动拟合）`选项，即可查看通过算法拟合出来的光强或通过自动mask的PI采集到的数据计算出来的光强。

![image-20220714210036412](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220714210036412.png)

2.5 记录数据

![image-20220715104657346](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715104657346.png)



#### 八、备注

1. **更改G-G的拟合方式（1次多项式拟合或2次多项式拟合）**

若需要更改G-G拟合的方式，如1次或2次多项式拟合，则进入到以下路径，打开`autograycalib.json`文件

![image-20220715101133324](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715101133324.png)

如下图所示，参数`"gg_degrees"`配置的数值即代表1次多项式拟合或2次多项式拟合

![image-20220715134033793](E:\文档\GitHub\Notiz\new-chairside 自动均匀性校准新流程及复检界面使用.assets\image-20220715134033793.png)

修改后保存，必须重启打印机才能生效。

