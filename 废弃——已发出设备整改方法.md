国外已发CSP设备远程整改方法



**国外需远程整改CSP设备：**

![image-20220829095825538](E:\文档\GitHub\Notiz\废弃——已发出设备整改方法.assets\image-20220829095825538.png)





**技术支持：**

客户设备——客户电脑

客户电脑——场内电脑

**见刘静分享文档`CSP 远程校准返工用--第三方远程协助（及vpn海外配置）`**



**场内电脑（part1——确定拟合GG参数）：**

1. 连接客户电脑后，备份客户设备数据；
   - 手动均匀性校准数据、PI数据——`energycalibparams.json`，路径`/home/heygears/.heygears/configs`![image-20220822093944643](E:\文档\GitHub\Notiz\废弃——已发出设备整改方法.assets\image-20220822093944643.png)
   - 自动mask（出厂前做过，保留在路径下）——`mask.png`，路径 `/home/heygears/app/release`![image-20220822112027435](E:\文档\GitHub\Notiz\废弃——已发出设备整改方法.assets\image-20220822112027435.png)

2. 使用脚本`csp_PI.py`和`gray_to_mask.py`分别提取`energycalibparams.json`中的手动mask手动 `PI列表`，和手动灰度转换成的手动mask图；
3. 在手动mask手动 `PI列表`中进行三次拟合，并将 `指定列表中的电流I` 复制进入，求得 `此指定电流列表下的光强P`；
4. 将 `自动mask`和手动 `mask_40`一起放入`pycharm`程序中，获取两者 `中心灰度值`；
5. 将灰度值记录到手动mask手动PI列表中，并近似出此时 `自动mask手动PI对应的光强列表`；
6. 将光强列表复制到 `csp出货整改模板`中；
7. 将 `csp出货excel`上的相机模组在设备上的 `IG数据`、相机模组 `母光源数据`复制到 `csp出货整改模板`，分析出合适的`GG参数`；
8. 更改 `db模板文件`



**软件运维：**

已知`设备SN码`，在场内电脑操作期间下发软件 `新版`



**场内电脑（part2——替换升级）：**

1. 升级软件
   - 客户设备：连接cloud，即可升级
2. 更新覆盖 `autograyclib.json`文件
3. 将修改好的 `db文件`覆盖原db文件
4. 重启（保证还是正常连接），然后查看 `日志` 中`gg`参数是否修改成功
5. 确认参数生效后，并请客户做进行一次自动均匀性校准
6. 整改完成。







**风险点：**

1. 整改后客户打印机光强无法复核，若之后出现打印问题，如何快速解决；
   - 按照客诉问题流程处理
2. 适配设备的相机模组SN码有不匹配情况发生（通达客退设备有该情况）；
   - 临时更改配置文件，再做模组设备适配







